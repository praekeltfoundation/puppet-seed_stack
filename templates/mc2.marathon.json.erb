{
  "id": "/seed-infra-mc2",
  "apps": [
    {
      "id": "/seed-infra-mc2/mc2",
      "cpus": 0.1,
      "mem": 256.0,
      "labels": {
        "domain": "mc2.<%= @infr_domain %>"
      },
      "container": {
        "type": "DOCKER",
        "docker": {
          "image": "praekeltfoundation/mc2",
          "forcePullImage": true,
          "network": "BRIDGE",
          "portMappings": [
            { "containerPort": 80, "hostPort": 0 }
          ],
          "parameters": [
            {"key": "volume-driver", "value": "xylem"},
            {"key": "volume", "value": "seed-infra-mc2:/data"}
          ]
        }
      },
      "env": {
        "MESOS_MARATHON_HOST": "http://marathon.service.consul:8080",
        "SECRET_KEY": "seekrit",
        "PROJECT_ROOT": "/deploy/",
        "DATABASE_URL": "sqlite:////data/mc2.db",
        "HUB_DOMAIN": "<%= @hub_domain %>",
        "DEBUG": "False"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/",
          "gracePeriodSeconds": 3,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 10,
          "maxConsecutiveFailures": 3
        }
      ]
    },
    {
      "id": "/seed-infra-mc2/marathon-consul",
      "args": [
        "--registry=http://consul.service.consul:8500",
        "--marathon-location=marathon.service.consul:8080"
      ],
      "container": {
        "type": "DOCKER",
        "docker": {
          "image": "ciscocloud/marathon-consul:0.2",
          "network": "BRIDGE",
          "portMappings": [
            {
              "containerPort": 4000,
              "hostPort": 4000
            }
          ]
        }
      },
      "ports": [4000],
      "healthChecks": [{
        "protocol": "HTTP",
        "path": "/health",
        "portIndex": 0
      }],
      "instances": 1,
      "cpus": 0.1,
      "mem": 128
    }
  ]
}
